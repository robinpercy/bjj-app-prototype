(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function r(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(t){if(t.ep)return;t.ep=!0;const a=r(t);fetch(t.href,a)}})();const w={posture_broken:{id:"posture_broken",name:"Posture Broken",icon:"üîª"},inside_position:{id:"inside_position",name:"Inside Position",icon:"üî≤"},arm_isolated:{id:"arm_isolated",name:"Arm Isolated",icon:"üí™"},leg_isolated:{id:"leg_isolated",name:"Leg Isolated",icon:"ü¶µ"},balance_compromised:{id:"balance_compromised",name:"Balance Compromised",icon:"‚öñÔ∏è"}},x={attack:{id:"attack",name:"Attack",icon:"‚öîÔ∏è",hint:"Submit or advance"},control:{id:"control",name:"Control",icon:"üõ°Ô∏è",hint:"Maintain & pressure"},defense:{id:"defense",name:"Defense",icon:"üîí",hint:"Protect & survive"},reversal:{id:"reversal",name:"Reversal",icon:"üîÑ",hint:"Escape & reverse"}},D={attack:{attack:0,control:1,defense:-1,reversal:0},control:{attack:-1,control:0,defense:0,reversal:1},defense:{attack:1,control:0,defense:0,reversal:-1},reversal:{attack:0,control:-1,defense:1,reversal:0}},g={standing_neutral:{id:"standing_neutral",name:"Standing Neutral",advantage:0,initiative:"neutral",topActions:["attack","control","defense","reversal"],bottomActions:["attack","control","defense","reversal"],autoClearTokens:["balance_compromised"],description:"Both fighters standing, no dominant grip or position."},closed_guard:{id:"closed_guard",name:"Closed Guard",advantage:0,initiative:"bottom",topActions:["attack","control","defense"],bottomActions:["attack","control","reversal"],autoClearTokens:[],description:"Bottom player has legs wrapped around top player."},open_guard:{id:"open_guard",name:"Open Guard",advantage:0,initiative:"bottom",topActions:["attack","control"],bottomActions:["attack","control","defense","reversal"],autoClearTokens:[],description:"Bottom player using feet and grips to control distance."},half_guard:{id:"half_guard",name:"Half Guard",advantage:1,initiative:"top",topActions:["attack","control"],bottomActions:["defense","reversal","control"],autoClearTokens:[],description:"Bottom player trapping one of top player's legs."},side_control:{id:"side_control",name:"Side Control",advantage:1,initiative:"top",topActions:["attack","control"],bottomActions:["defense","reversal"],autoClearTokens:["balance_compromised"],description:"Top player pinning from the side, chest-to-chest."},mount:{id:"mount",name:"Mount",advantage:2,initiative:"top",topActions:["attack","control"],bottomActions:["defense","reversal"],autoClearTokens:["balance_compromised"],description:"Top player sitting on bottom player's torso."},back_control:{id:"back_control",name:"Back Control",advantage:2,initiative:"top",topActions:["attack","control"],bottomActions:["defense","reversal"],autoClearTokens:["balance_compromised","inside_position"],description:"Behind the opponent with hooks or body triangle."},turtle:{id:"turtle",name:"Turtle",advantage:1,initiative:"top",topActions:["attack","control"],bottomActions:["defense","reversal"],autoClearTokens:["posture_broken"],description:"Bottom player balled up on hands and knees."},front_headlock:{id:"front_headlock",name:"Front Headlock",advantage:1,initiative:"top",topActions:["attack","control"],bottomActions:["defense","reversal"],autoClearTokens:[],description:"Top player controlling the head from the front."},knee_shield:{id:"knee_shield",name:"Knee Shield Half Guard",advantage:0,initiative:"bottom",topActions:["attack","control"],bottomActions:["attack","defense","reversal","control"],autoClearTokens:[],description:"Half guard variant with knee frame creating distance."}},P=[{id:"takedown",name:"Takedown",category:"attack",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"side_control",userBecomesTop:!0},isSubmission:!1},{id:"guard_pull",name:"Guard Pull",category:"attack",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"}],modifier:0,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"closed_guard",userBecomesTop:!1},isSubmission:!1},{id:"knee_cut_pass",name:"Knee Cut Pass",category:"attack",availableFrom:[{position:"open_guard",role:"top"},{position:"knee_shield",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"side_control",userBecomesTop:!0},isSubmission:!1},{id:"torreando_pass",name:"Toreando Pass",category:"attack",availableFrom:[{position:"open_guard",role:"top"}],modifier:1,risk:"risky",requiredTokens:[],tokenReward:null,transition:{position:"side_control",userBecomesTop:!0},isSubmission:!1},{id:"mount_transition",name:"Mount Transition",category:"attack",availableFrom:[{position:"side_control",role:"top"},{position:"half_guard",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"mount",userBecomesTop:!0},isSubmission:!1},{id:"back_take",name:"Back Take",category:"attack",availableFrom:[{position:"mount",role:"top"},{position:"turtle",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"back_control",userBecomesTop:!0},isSubmission:!1},{id:"americana",name:"Americana",category:"attack",availableFrom:[{position:"side_control",role:"top"},{position:"mount",role:"top"}],modifier:2,risk:"neutral",requiredTokens:["arm_isolated"],tokenReward:null,transition:null,isSubmission:!0},{id:"kimura",name:"Kimura",category:"attack",availableFrom:[{position:"side_control",role:"top"},{position:"closed_guard",role:"bottom"},{position:"half_guard",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!0},{id:"cross_collar_choke",name:"Cross Collar Choke",category:"attack",availableFrom:[{position:"mount",role:"top"},{position:"closed_guard",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:["posture_broken"],tokenReward:null,transition:null,isSubmission:!0},{id:"rear_naked_choke",name:"Rear Naked Choke",category:"attack",availableFrom:[{position:"back_control",role:"top"}],modifier:3,risk:"neutral",requiredTokens:["posture_broken"],tokenReward:null,transition:null,isSubmission:!0},{id:"armbar",name:"Armbar",category:"attack",availableFrom:[{position:"mount",role:"top"},{position:"closed_guard",role:"bottom"},{position:"back_control",role:"top"}],modifier:2,risk:"risky",requiredTokens:["arm_isolated"],tokenReward:null,transition:null,isSubmission:!0},{id:"triangle",name:"Triangle Choke",category:"attack",availableFrom:[{position:"closed_guard",role:"bottom"},{position:"open_guard",role:"bottom"}],modifier:2,risk:"risky",requiredTokens:["posture_broken"],tokenReward:null,transition:null,isSubmission:!0},{id:"guillotine",name:"Guillotine",category:"attack",availableFrom:[{position:"front_headlock",role:"top"},{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"},{position:"closed_guard",role:"bottom"}],modifier:2,risk:"risky",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!0},{id:"darce_choke",name:"D'Arce Choke",category:"attack",availableFrom:[{position:"front_headlock",role:"top"},{position:"side_control",role:"top"}],modifier:2,risk:"risky",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!0},{id:"ezekiel_choke",name:"Ezekiel Choke",category:"attack",availableFrom:[{position:"mount",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!0},{id:"ankle_lock",name:"Ankle Lock",category:"attack",availableFrom:[{position:"open_guard",role:"bottom"},{position:"open_guard",role:"top"}],modifier:1,risk:"risky",requiredTokens:["leg_isolated"],tokenReward:null,transition:null,isSubmission:!0},{id:"crossface",name:"Crossface",category:"control",availableFrom:[{position:"side_control",role:"top"},{position:"half_guard",role:"top"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1},{id:"chest_pressure",name:"Chest Pressure",category:"control",availableFrom:[{position:"mount",role:"top"},{position:"side_control",role:"top"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1},{id:"seatbelt_grip",name:"Seatbelt Grip",category:"control",availableFrom:[{position:"back_control",role:"top"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1},{id:"head_control",name:"Head Control",category:"control",availableFrom:[{position:"front_headlock",role:"top"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1},{id:"collar_tie",name:"Collar Tie",category:"control",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1},{id:"posture_break",name:"Posture Break",category:"control",availableFrom:[{position:"closed_guard",role:"bottom"},{position:"open_guard",role:"bottom"},{position:"closed_guard",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:"posture_broken",transition:null,isSubmission:!1},{id:"underhook_control",name:"Underhook",category:"control",availableFrom:[{position:"half_guard",role:"bottom"},{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"},{position:"knee_shield",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:"inside_position",transition:null,isSubmission:!1},{id:"wrist_control",name:"Wrist Control",category:"control",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"},{position:"closed_guard",role:"top"},{position:"closed_guard",role:"bottom"},{position:"open_guard",role:"top"},{position:"open_guard",role:"bottom"},{position:"mount",role:"top"},{position:"side_control",role:"top"},{position:"half_guard",role:"top"},{position:"back_control",role:"top"},{position:"knee_shield",role:"bottom"}],modifier:0,risk:"neutral",requiredTokens:[],tokenReward:"arm_isolated",transition:null,isSubmission:!1},{id:"leg_lace",name:"Leg Entangle",category:"control",availableFrom:[{position:"open_guard",role:"top"},{position:"open_guard",role:"bottom"},{position:"half_guard",role:"bottom"},{position:"knee_shield",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:"leg_isolated",transition:null,isSubmission:!1},{id:"knee_shield_frame",name:"Knee Shield",category:"control",availableFrom:[{position:"knee_shield",role:"bottom"},{position:"half_guard",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1},{id:"body_lock",name:"Body Lock",category:"control",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"},{position:"back_control",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:"balance_compromised",transition:null,isSubmission:!1},{id:"frame_and_shrimp",name:"Frame & Shrimp",category:"defense",availableFrom:[{position:"side_control",role:"bottom"},{position:"mount",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1},{id:"guard_recovery",name:"Guard Recovery",category:"defense",availableFrom:[{position:"side_control",role:"bottom"},{position:"half_guard",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"closed_guard",userBecomesTop:!1},isSubmission:!1},{id:"posture_up",name:"Posture Up",category:"defense",availableFrom:[{position:"closed_guard",role:"top"},{position:"open_guard",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,tokenRemove:"posture_broken",transition:null,isSubmission:!1},{id:"hand_fighting",name:"Hand Fighting",category:"defense",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"},{position:"closed_guard",role:"top"},{position:"closed_guard",role:"bottom"},{position:"open_guard",role:"top"},{position:"open_guard",role:"bottom"},{position:"side_control",role:"bottom"},{position:"mount",role:"bottom"},{position:"back_control",role:"bottom"},{position:"knee_shield",role:"bottom"}],modifier:0,risk:"neutral",requiredTokens:[],tokenReward:null,tokenRemove:"arm_isolated",transition:null,isSubmission:!1},{id:"bridge",name:"Bridge",category:"defense",availableFrom:[{position:"mount",role:"bottom"},{position:"side_control",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1},{id:"turtle_up",name:"Turtle Up",category:"defense",availableFrom:[{position:"side_control",role:"bottom"},{position:"mount",role:"bottom"},{position:"back_control",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"turtle",userBecomesTop:!1},isSubmission:!1},{id:"sprawl",name:"Sprawl",category:"defense",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1},{id:"shell_guard",name:"Shell Guard",category:"defense",availableFrom:[{position:"mount",role:"bottom"},{position:"back_control",role:"bottom"},{position:"side_control",role:"bottom"},{position:"front_headlock",role:"bottom"},{position:"turtle",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1},{id:"scissor_sweep",name:"Scissor Sweep",category:"reversal",availableFrom:[{position:"closed_guard",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"mount",userBecomesTop:!0},isSubmission:!1},{id:"hip_bump_sweep",name:"Hip Bump Sweep",category:"reversal",availableFrom:[{position:"closed_guard",role:"bottom"}],modifier:3,risk:"risky",requiredTokens:[],tokenReward:null,transition:{position:"mount",userBecomesTop:!0},isSubmission:!1},{id:"elbow_escape",name:"Elbow Escape",category:"reversal",availableFrom:[{position:"mount",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"half_guard",userBecomesTop:!1},isSubmission:!1},{id:"trap_and_roll",name:"Trap & Roll",category:"reversal",availableFrom:[{position:"mount",role:"bottom"}],modifier:3,risk:"neutral",requiredTokens:["arm_isolated"],tokenReward:null,transition:{position:"closed_guard",userBecomesTop:!0},isSubmission:!1},{id:"granby_roll",name:"Granby Roll",category:"reversal",availableFrom:[{position:"turtle",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"closed_guard",userBecomesTop:!1},isSubmission:!1},{id:"technical_standup",name:"Technical Standup",category:"reversal",availableFrom:[{position:"open_guard",role:"bottom"},{position:"closed_guard",role:"bottom"},{position:"knee_shield",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"standing_neutral",userBecomesTop:!1},isSubmission:!1},{id:"back_escape",name:"Back Escape",category:"reversal",availableFrom:[{position:"back_control",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"half_guard",userBecomesTop:!1},isSubmission:!1},{id:"old_school_sweep",name:"Old School Sweep",category:"reversal",availableFrom:[{position:"half_guard",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:["inside_position"],tokenReward:null,transition:{position:"side_control",userBecomesTop:!0},isSubmission:!1},{id:"sit_out",name:"Sit Out",category:"reversal",availableFrom:[{position:"turtle",role:"bottom"},{position:"front_headlock",role:"bottom"}],modifier:2,risk:"risky",requiredTokens:[],tokenReward:null,transition:{position:"standing_neutral",userBecomesTop:!1},isSubmission:!1},{id:"knee_shield_recover",name:"Reguard to Knee Shield",category:"reversal",availableFrom:[{position:"side_control",role:"bottom"},{position:"half_guard",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"knee_shield",userBecomesTop:!1},isSubmission:!1},{id:"headlock_escape",name:"Duck Under",category:"reversal",availableFrom:[{position:"front_headlock",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"back_control",userBecomesTop:!0},isSubmission:!1}];function v(e,o,r=null){return P.filter(s=>!(!s.availableFrom.some(a=>a.position===e&&a.role===o)||r&&s.category!==r))}function C(e,o){return!e.requiredTokens||e.requiredTokens.length===0?!0:e.requiredTokens.every(r=>o.includes(r))}function B(e,o){const r=g[e];return r?o==="top"?r.topActions:r.bottomActions:[]}function H(e,o){return D[e]?.[o]??0}const F=2,q=12,h={MATCH_START:"match_start",TURN_START:"turn_start",ACTION_SELECTION:"action_selection",ACTION_LOCKED:"action_locked",RESOLUTION:"resolution",TURN_END:"turn_end",MATCH_END:"match_end"},y={MINOR:"minor",MAJOR:"major",DOMINANT:"dominant"};function I(){return{phase:h.MATCH_START,turnNumber:0,position:"standing_neutral",playerIsTop:!0,scores:{player:0,ai:0},tokens:{player:[],ai:[]},playerCategory:null,playerTechnique:null,aiCategory:null,aiTechnique:null,lastResolution:null,matchWinner:null,matchEndReason:null,aiDifficulty:"medium"}}function U(){return Math.floor(Math.random()*6)+1}function A(e,o,r){const s=e.tokens[o];return s.includes(r)||s.length>=F?!1:(s.push(r),!0)}function T(e,o,r){const s=e.tokens[o],t=s.indexOf(r);return t===-1?!1:(s.splice(t,1),!0)}function G(e,o){const r=g[o];if(!(!r||!r.autoClearTokens))for(const s of r.autoClearTokens)T(e,"player",s),T(e,"ai",s)}function N(e,o,r,s,t,a){const n=g[e],l=o?n.advantage:0,d=H(r,t),i=s.modifier,u=a.length,p=U();return{total:l+d+i+u+p,breakdown:{posAdvantage:l,matchupMod:d,techniqueMod:i,tokenMod:u,die:p}}}function W(e){return e<=1?y.MINOR:e<=3?y.MAJOR:y.DOMINANT}function Y(e){const o=N(e.position,e.playerIsTop,e.playerCategory,e.playerTechnique,e.aiCategory,e.tokens.player),r=N(e.position,!e.playerIsTop,e.aiCategory,e.aiTechnique,e.playerCategory,e.tokens.ai),s=Math.abs(o.total-r.total),t=o.total>=r.total?"player":"ai",a=t==="player"?"ai":"player",n=W(s),l=t==="player"?e.playerTechnique:e.aiTechnique,d=t==="player"?e.aiTechnique:e.playerTechnique,i={playerScore:o,aiScore:r,margin:s,winner:t,loser:a,tier:n,winnerTechnique:l,loserTechnique:d,pointsAwarded:0,tokensGained:[],tokensLost:[],positionChange:null,submission:!1,narratives:[]};if(l.isSubmission&&n===y.DOMINANT)return i.submission=!0,i.narratives.push(`${l.name} locked in! Submission!`),i;if(n===y.MAJOR?i.pointsAwarded=1:n===y.DOMINANT&&(i.pointsAwarded=2),(n===y.MAJOR||n===y.DOMINANT)&&(l.tokenReward&&A(e,t,l.tokenReward)&&(i.tokensGained.push({who:t,token:l.tokenReward}),i.narratives.push(`${t==="player"?"You gain":"Opponent gains"} ${w[l.tokenReward].name}!`)),n===y.DOMINANT&&!l.tokenReward)){const u=["posture_broken","inside_position","arm_isolated","balance_compromised","leg_isolated"],p=e.tokens[t],m=u.filter(k=>!p.includes(k));if(m.length>0&&p.length<F){const k=m[Math.floor(Math.random()*m.length)];A(e,t,k),i.tokensGained.push({who:t,token:k}),i.narratives.push(`${t==="player"?"You gain":"Opponent gains"} ${w[k].name}!`)}}if(l.tokenRemove&&n!==y.MINOR&&T(e,a,l.tokenRemove)&&(i.tokensLost.push({who:a,token:l.tokenRemove}),i.narratives.push(`${a==="player"?"You lose":"Opponent loses"} ${w[l.tokenRemove].name}!`)),n===y.DOMINANT&&e.tokens[a].length>0){const u=e.tokens[a][0];T(e,a,u),i.tokensLost.push({who:a,token:u}),i.narratives.push(`${a==="player"?"You lose":"Opponent loses"} ${w[u].name}!`)}if(l.transition){const u=l.transition,p=e.position;i.positionChange={from:p,to:u.position};const m=g[u.position],k=g[p];if(m.advantage>k.advantage){const b=m.advantage-k.advantage;i.pointsAwarded+=b,i.narratives.push(`Position advance! +${b} bonus points.`)}t==="player"?e.playerIsTop=u.userBecomesTop:e.playerIsTop=!u.userBecomesTop,e.position=u.position,G(e,u.position),i.narratives.push(`Transition to ${m.name}!`)}return i.pointsAwarded>0&&(e.scores[t]+=i.pointsAwarded,i.narratives.push(`${t==="player"?"You score":"Opponent scores"} ${i.pointsAwarded} point${i.pointsAwarded>1?"s":""}!`)),n===y.MINOR&&i.narratives.push("A tense exchange ‚Äî neither fighter gains much ground."),i}function K(e){e.phase=h.TURN_START,e.turnNumber=1,e.position="standing_neutral",e.playerIsTop=Math.random()>.5,e.scores={player:0,ai:0},e.tokens={player:[],ai:[]},e.matchWinner=null,e.matchEndReason=null,e.lastResolution=null}function j(e){e.phase=h.ACTION_SELECTION,e.playerCategory=null,e.playerTechnique=null,e.aiCategory=null,e.aiTechnique=null}function J(e,o,r,s,t){e.playerCategory=o,e.playerTechnique=r,e.aiCategory=s,e.aiTechnique=t,e.phase=h.ACTION_LOCKED}function z(e){e.phase=h.RESOLUTION;const o=Y(e);return e.lastResolution=o,o.submission?(e.matchWinner=o.winner,e.matchEndReason=`Submission by ${o.winnerTechnique.name}!`,e.phase=h.MATCH_END,o):e.scores.player>=q?(e.matchWinner="player",e.matchEndReason="Points victory!",e.phase=h.MATCH_END,o):e.scores.ai>=q?(e.matchWinner="ai",e.matchEndReason="Points victory!",e.phase=h.MATCH_END,o):(e.phase=h.TURN_END,o)}function Q(e){e.turnNumber++,e.phase=h.TURN_START}function _(e){return g[e.position].initiative==="neutral",e.playerIsTop?"top":"bottom"}function V(e){return B(e.position,_(e))}function X(e,o){return v(e.position,_(e),o)}function Z(e,o){return C(o,e.tokens.player)}const M={easy:{optimalWeight:.4},medium:{optimalWeight:.65},hard:{optimalWeight:.85}};function ee(e,o,r,s,t,a){let n=0;const l=g[e];if(n+=s.modifier*2,s.isSubmission&&(n+=3,C(s,t)&&(n+=4)),s.transition){const d=g[s.transition.position];if(d){const i=s.transition.userBecomesTop?d.advantage-(o==="top"?l.advantage:0):0-l.advantage;n+=i*2,l.advantage===0&&d.advantage>0&&s.transition.userBecomesTop&&(n+=3)}}return s.tokenReward&&t.length<2&&(n+=2,n+=1),s.tokenRemove&&a.length>0&&(n+=2),s.risk==="risky"&&(n-=1),r==="control"&&o==="top"&&(n+=1),r==="defense"&&o==="bottom"&&l.advantage>=2&&(n+=2),Math.max(n,0)}function oe(e){const o=M[e.aiDifficulty]||M.medium,r=e.playerIsTop?"bottom":"top",s=B(e.position,r);if(s.length===0)throw new Error(`AI has no available categories at position ${e.position} as ${r}`);const t=[];for(const i of s){const u=v(e.position,r,i);for(const p of u){if(!C(p,e.tokens.ai))continue;const k=ee(e.position,r,i,p,e.tokens.ai,e.tokens.player);t.push({category:i,technique:p,score:k})}}if(t.length===0)for(const i of s){const u=v(e.position,r,i);for(const p of u)t.push({category:i,technique:p,score:1})}if(t.length===0)throw new Error("AI has no available techniques");t.sort((i,u)=>u.score-i.score);const a=t[0].score,n=t.filter(i=>i.score>=a-1),l=t.filter(i=>i.score<a-1);let d;return Math.random()<o.optimalWeight&&n.length>0?d=n[Math.floor(Math.random()*n.length)]:l.length>0?d=l[Math.floor(Math.random()*l.length)]:d=n[Math.floor(Math.random()*n.length)],{category:d.category,technique:d.technique}}const c=e=>document.getElementById(e),E={standing_neutral:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.6"><circle cx="65" cy="35" r="12" stroke="#f85149" stroke-width="2.5" fill="none"/>
      <line x1="65" y1="47" x2="65" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="65" y1="65" x2="45" y2="85" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="65" y1="65" x2="85" y2="85" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="65" y1="100" x2="50" y2="140" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="65" y1="100" x2="80" y2="140" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
      <g opacity="0.6"><circle cx="115" cy="35" r="12" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="115" y1="47" x2="115" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="115" y1="65" x2="95" y2="85" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="115" y1="65" x2="135" y2="85" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="115" y1="100" x2="100" y2="140" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="115" y1="100" x2="130" y2="140" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,closed_guard:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><line x1="40" y1="120" x2="140" y2="120" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <circle cx="140" cy="120" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="80" y1="120" x2="75" y2="90" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="120" x2="95" y2="90" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="50" y1="120" x2="35" y2="145" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="60" y1="120" x2="50" y2="150" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="85" cy="70" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="85" y1="81" x2="85" y2="115" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="85" y1="90" x2="65" y2="105" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="85" y1="90" x2="105" y2="105" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="85" y1="115" x2="70" y2="140" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="85" y1="115" x2="100" y2="140" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,open_guard:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><line x1="50" y1="125" x2="140" y2="125" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <circle cx="140" cy="125" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="80" y1="125" x2="70" y2="95" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="125" x2="90" y2="95" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="55" y1="125" x2="50" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="60" y1="125" x2="65" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="80" cy="62" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="80" y1="73" x2="80" y2="108" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="80" y1="85" x2="60" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="85" x2="100" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="108" x2="65" y2="135" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="108" x2="95" y2="135" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,half_guard:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><line x1="45" y1="125" x2="135" y2="125" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <circle cx="135" cy="125" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="85" y1="125" x2="80" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="95" y1="125" x2="90" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="55" y1="125" x2="55" y2="145" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="65" y1="125" x2="75" y2="140" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="80" cy="75" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="80" y1="86" x2="85" y2="118" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="80" y1="95" x2="60" y2="110" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="95" x2="100" y2="110" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="85" y1="118" x2="70" y2="145" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="85" y1="118" x2="100" y2="145" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,side_control:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><line x1="35" y1="125" x2="140" y2="125" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <circle cx="140" cy="125" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="90" y1="125" x2="95" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="110" y1="125" x2="108" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="45" y1="125" x2="30" y2="150" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="55" y1="125" x2="45" y2="155" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><line x1="70" y1="95" x2="115" y2="80" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <circle cx="65" cy="90" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="85" y1="90" x2="100" y2="115" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="85" x2="120" y2="108" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="115" y1="80" x2="140" y2="65" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="115" y1="80" x2="145" y2="82" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,mount:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><line x1="35" y1="130" x2="145" y2="130" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <circle cx="145" cy="130" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="90" y1="130" x2="85" y2="105" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="110" y1="130" x2="115" y2="105" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="45" y1="130" x2="30" y2="155" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="55" y1="130" x2="50" y2="158" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="90" cy="60" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="90" y1="71" x2="90" y2="110" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="90" y1="85" x2="65" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="85" x2="115" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="110" x2="70" y2="135" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="110" x2="110" y2="135" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,back_control:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><circle cx="90" cy="80" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="90" y1="91" x2="90" y2="125" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="105" x2="70" y2="115" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="105" x2="110" y2="115" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="125" x2="75" y2="150" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="125" x2="105" y2="150" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="90" cy="55" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="90" y1="66" x2="90" y2="100" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="90" y1="78" x2="68" y2="95" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="78" x2="112" y2="95" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="100" x2="72" y2="128" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="100" x2="108" y2="128" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,turtle:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><circle cx="130" cy="115" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="120" y1="115" x2="70" y2="110" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="112" x2="95" y2="140" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="111" x2="75" y2="140" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="105" y1="112" x2="115" y2="138" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="75" y1="111" x2="60" y2="138" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="90" cy="72" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="90" y1="83" x2="90" y2="108" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="90" y1="92" x2="65" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="92" x2="115" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="108" x2="75" y2="135" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="108" x2="105" y2="135" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,front_headlock:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><circle cx="100" cy="95" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="100" y1="106" x2="95" y2="130" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="112" x2="80" y2="125" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="112" x2="120" y2="120" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="95" y1="130" x2="80" y2="155" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="95" y1="130" x2="110" y2="155" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="80" cy="55" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="80" y1="66" x2="80" y2="100" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="80" y1="78" x2="60" y2="90" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="78" x2="100" y2="88" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="100" x2="65" y2="130" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="100" x2="95" y2="130" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,knee_shield:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><line x1="45" y1="125" x2="140" y2="125" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <circle cx="140" cy="125" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="90" y1="125" x2="80" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="125" x2="90" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="55" y1="125" x2="55" y2="95" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="65" y1="125" x2="85" y2="105" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="80" cy="68" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="80" y1="79" x2="82" y2="112" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="80" y1="90" x2="60" y2="105" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="90" x2="100" y2="105" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="82" y1="112" x2="67" y2="140" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="82" y1="112" x2="97" y2="140" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`},te={takedown:"ü§º",guard_pull:"‚¨áÔ∏è",knee_cut_pass:"ü¶µ",torreando_pass:"üí®",mount_transition:"‚¨ÜÔ∏è",back_take:"üîÑ",americana:"üí™",kimura:"üîí",cross_collar_choke:"‚úã",rear_naked_choke:"üêç",armbar:"üí™",triangle:"üî∫",guillotine:"‚ö°",darce_choke:"üåÄ",ezekiel_choke:"‚úä",ankle_lock:"ü¶∂",crossface:"ü§ö",chest_pressure:"‚¨áÔ∏è",seatbelt_grip:"üîó",head_control:"‚úã",collar_tie:"ü§ù",posture_break:"‚¨áÔ∏è",underhook_control:"üî≤",wrist_control:"‚úä",leg_lace:"ü¶µ",knee_shield_frame:"üõ°Ô∏è",body_lock:"üîí",frame_and_shrimp:"ü¶ê",guard_recovery:"üîÑ",posture_up:"‚¨ÜÔ∏è",hand_fighting:"‚úã",bridge:"üåâ",turtle_up:"üê¢",sprawl:"üèãÔ∏è",shell_guard:"üõ°Ô∏è",scissor_sweep:"‚úÇÔ∏è",hip_bump_sweep:"üí•",elbow_escape:"üîì",trap_and_roll:"üé≤",granby_roll:"üåÄ",technical_standup:"üßç",back_escape:"üèÉ",old_school_sweep:"üîÑ",sit_out:"‚Ü©Ô∏è",knee_shield_recover:"üõ°Ô∏è",headlock_escape:"‚Ü™Ô∏è"};function ne(e){const o=[];if(e.isSubmission&&o.push("Submission attempt"),e.transition){const r=g[e.transition.position];o.push(`‚Üí ${r?.name||e.transition.position}`)}return e.tokenReward&&o.push(`Earns: ${w[e.tokenReward].name}`),e.tokenRemove&&o.push(`Removes opp: ${w[e.tokenRemove].name}`),e.risk==="risky"&&o.push("Risky"),o.length===0&&o.push("Maintain position"),o.join(" ¬∑ ")}function S(e){document.querySelectorAll(".screen").forEach(o=>{o.classList.remove("active")}),c(e).classList.add("active")}function ie(e){const o=g[e.position],r=_(e);c("score-player").textContent=e.scores.player,c("score-ai").textContent=e.scores.ai,c("turn-number").textContent=e.turnNumber,c("ai-difficulty-label").textContent=e.aiDifficulty.charAt(0).toUpperCase()+e.aiDifficulty.slice(1),c("position-name").textContent=o.name;const s=c("initiative-badge");s.className="initiative-badge "+(r==="top"?"top":r==="bottom"?"bottom":"neutral");const t=r==="top"?"You: Top Position":o.initiative==="neutral"?"Neutral":"You: Bottom Position";c("initiative-text").textContent=t,c("silhouette-container").innerHTML=E[e.position]||E.standing_neutral;const a=c("advantage-pips");a.innerHTML="";for(let d=0;d<3;d++){const i=document.createElement("div");i.className="pip"+(d<o.advantage?" filled":""),a.appendChild(i)}c("advantage-value").textContent=o.advantage>0?`+${o.advantage}`:"+0",O("player-tokens",e.tokens.player),O("ai-tokens",e.tokens.ai);const n=c("turn-text"),l=c("pulse-dot");n.textContent="Select Your Action",n.className="turn-text selecting",l.className="pulse-dot"}function O(e,o){const r=c(e);r.innerHTML="";for(let s=0;s<2;s++){const t=document.createElement("div");if(o[s]){const a=w[o[s]];t.className="token-badge active",t.innerHTML=`<span class="token-icon">${a.icon}</span> ${a.name}`}else t.className="token-badge empty",t.innerHTML='<span class="token-icon">‚óã</span> Empty';r.appendChild(t)}}function re(e,o){const r=c("action-grid");r.innerHTML="";const s=_(e),t=V(e),a=["attack","control","defense","reversal"],n=s==="top"?["attack"]:["reversal"];for(const l of a){const d=x[l],i=t.includes(l),u=document.createElement("div"),p=i?v(e.position,s,l):[],m=p.length>0&&p.every(b=>b.risk==="risky");let k;i?n.includes(l)?k="optimal":m?k="risky":k="neutral":k="disabled",u.className=`action-btn ${k}`,u.innerHTML=`
      <span class="act-icon">${d.icon}</span>
      <span class="act-name">${d.name}</span>
      <span class="act-hint">${d.hint}</span>
    `,i&&u.addEventListener("click",()=>o(l)),r.appendChild(u)}}function se(e,o,r){const s=x[o];_(e);const t=X(e,o);c("drawer-title").textContent=`${s.name} Techniques`,c("drawer-title").style.color=o==="attack"?"var(--red)":o==="control"?"var(--accent)":o==="defense"?"var(--green)":"var(--purple)";const a=c("technique-list");a.innerHTML="";for(const n of t){const l=Z(e,n),d=document.createElement("div");d.className="technique-item"+(l?"":" locked");const i=n.requiredTokens.length>0?n.requiredTokens.map(k=>w[k].name).join(", "):"No requirement",u=n.requiredTokens.length>0?l?"":" locked-req":" none",p=te[n.id]||"‚ö°",m=ne(n);d.innerHTML=`
      <span class="tech-icon">${p}</span>
      <div class="tech-info">
        <div class="tech-name">${n.name}</div>
        <div class="tech-desc">${m}</div>
      </div>
      <div class="tech-meta">
        <span class="tech-mod">+${n.modifier}</span>
        <span class="tech-req${u}">${l?"":"üîí "}${i}</span>
      </div>
    `,l&&d.addEventListener("click",()=>{R(),r(n)}),a.appendChild(d)}c("technique-drawer").classList.add("open"),c("overlay-backdrop").classList.add("visible")}function R(){c("technique-drawer").classList.remove("open"),c("overlay-backdrop").classList.remove("visible")}function ae(e,o,r){const s=c("resolution-overlay"),t=c("res-header");if(o.submission)t.textContent="SUBMISSION!",t.className="res-header submission";else{const k={minor:"Minor Exchange",major:"Major Exchange",dominant:"Dominant Exchange"};t.textContent=k[o.tier]||"Resolution",t.className="res-header "+o.tier}const a=x[e.playerCategory];c("res-player-category").textContent=a.icon+" "+a.name,c("res-player-technique").textContent=e.playerTechnique.name,c("res-player-score").textContent=o.playerScore.total;const n=o.playerScore.breakdown;c("res-player-breakdown").innerHTML=`Pos: ${n.posAdvantage} ¬∑ Match: ${n.matchupMod>0?"+":""}${n.matchupMod}<br>Tech: +${n.techniqueMod} ¬∑ Tok: +${n.tokenMod} ¬∑ Die: ${n.die}`;const l=x[e.aiCategory];c("res-ai-category").textContent=l.icon+" "+l.name,c("res-ai-technique").textContent=e.aiTechnique.name,c("res-ai-score").textContent=o.aiScore.total;const d=o.aiScore.breakdown;c("res-ai-breakdown").innerHTML=`Pos: ${d.posAdvantage} ¬∑ Match: ${d.matchupMod>0?"+":""}${d.matchupMod}<br>Tech: +${d.techniqueMod} ¬∑ Tok: +${d.tokenMod} ¬∑ Die: ${d.die}`;const i=c("res-outcome");o.winner==="player"?(i.textContent=o.submission?`You win by ${o.winnerTechnique.name}!`:`You win the exchange! (margin: ${o.margin})`,i.className="res-outcome win"):o.margin===0?(i.textContent="Even exchange!",i.className="res-outcome draw"):(i.textContent=o.submission?`Opponent wins by ${o.winnerTechnique.name}!`:`Opponent wins the exchange! (margin: ${o.margin})`,i.className="res-outcome lose");const u=c("res-narratives");u.innerHTML="";for(const k of o.narratives){const b=document.createElement("div");b.className="res-narrative-item",b.textContent=k,u.appendChild(b)}s.classList.add("visible");const p=c("res-continue"),m=p.cloneNode(!0);p.parentNode.replaceChild(m,p),m.id="res-continue",m.addEventListener("click",()=>{s.classList.remove("visible"),r()})}function le(e,o,r){const s=e.matchWinner==="player";c("end-icon").textContent=s?"üèÜ":"üòî",c("end-title").textContent=s?"Victory!":"Defeat",c("end-title").className="end-title "+(s?"win":"lose"),c("end-reason").textContent=e.matchEndReason||"",c("end-score").innerHTML=`<span style="color:var(--accent)">${e.scores.player}</span> <span style="color:var(--text-dim)">‚Äì</span> <span style="color:var(--red)">${e.scores.ai}</span>`;const t=c("btn-rematch"),a=c("btn-menu"),n=t.cloneNode(!0),l=a.cloneNode(!0);t.parentNode.replaceChild(n,t),a.parentNode.replaceChild(l,a),n.id="btn-rematch",l.id="btn-menu",n.addEventListener("click",o),l.addEventListener("click",r),S("screen-end")}function ce(){const e=c("turn-text");e.textContent="Resolving...",e.className="turn-text resolving",c("pulse-dot").className="pulse-dot resolving",document.querySelectorAll(".action-btn").forEach(o=>{o.classList.add("disabled"),o.style.pointerEvents="none"})}let f=I();function de(){document.querySelectorAll(".diff-btn").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".diff-btn").forEach(o=>o.classList.remove("active")),e.classList.add("active"),f.aiDifficulty=e.dataset.diff})}),document.getElementById("btn-start").addEventListener("click",()=>{$()})}function $(){f=I();const e=document.querySelector(".diff-btn.active");e&&(f.aiDifficulty=e.dataset.diff),K(f),S("screen-match"),L()}function L(){j(f),ie(f),re(f,ue)}function ue(e){se(f,e,pe)}function pe(e){const o=oe(f);J(f,e.category,e,o.category,o.technique),ce(),setTimeout(()=>{const r=z(f);ae(f,r,()=>{f.phase===h.MATCH_END?le(f,()=>$(),()=>{S("screen-start")}):(Q(f),L())})},600)}document.getElementById("overlay-backdrop").addEventListener("click",R);document.getElementById("drawer-close").addEventListener("click",R);de();S("screen-start");
