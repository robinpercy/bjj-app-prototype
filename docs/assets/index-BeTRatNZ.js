(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const t of l.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&n(t)}).observe(document,{childList:!0,subtree:!0});function r(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=r(i);fetch(i.href,l)}})();const b={posture_broken:{id:"posture_broken",name:"Posture Broken",icon:"üîª"},inside_position:{id:"inside_position",name:"Inside Position",icon:"üî≤"},arm_isolated:{id:"arm_isolated",name:"Arm Isolated",icon:"üí™"},leg_isolated:{id:"leg_isolated",name:"Leg Isolated",icon:"ü¶µ"},balance_compromised:{id:"balance_compromised",name:"Balance Compromised",icon:"‚öñÔ∏è"}},v={attack:{id:"attack",name:"Attack",icon:"‚öîÔ∏è",hint:"Submit or advance"},control:{id:"control",name:"Increase Control",icon:"üõ°Ô∏è",hint:"Maintain & pressure"},defense:{id:"defense",name:"Defense",icon:"üîí",hint:"Protect & survive"},sweep:{id:"sweep",name:"Sweep",icon:"üîÑ",hint:"Escape & reposition"}},U={attack:{attack:0,control:0,defense:1,sweep:-1},control:{attack:0,control:0,defense:-1,sweep:1},defense:{attack:-1,control:1,defense:0,sweep:0},sweep:{attack:1,control:-1,defense:0,sweep:0}},w={standing_neutral:{id:"standing_neutral",name:"Standing Neutral",initiative:"neutral",topActions:["attack","control","defense"],bottomActions:["attack","control","defense"],autoClearTokens:["balance_compromised"],description:"Both fighters standing, no dominant grip or position."},closed_guard:{id:"closed_guard",name:"Closed Guard",initiative:"bottom",topActions:["attack","control","defense"],bottomActions:["attack","control","sweep"],autoClearTokens:[],description:"Bottom player has legs wrapped around top player."},open_guard:{id:"open_guard",name:"Open Guard",initiative:"bottom",topActions:["attack","control"],bottomActions:["attack","control","defense","sweep"],autoClearTokens:[],description:"Bottom player using feet and grips to control distance."},half_guard:{id:"half_guard",name:"Half Guard",initiative:"top",topActions:["attack","control"],bottomActions:["defense","sweep","control"],autoClearTokens:[],description:"Bottom player trapping one of top player's legs."},side_control:{id:"side_control",name:"Side Control",initiative:"top",topActions:["attack","control"],bottomActions:["defense","sweep"],autoClearTokens:["balance_compromised"],description:"Top player pinning from the side, chest-to-chest."},mount:{id:"mount",name:"Mount",initiative:"top",topActions:["attack","control"],bottomActions:["defense","sweep"],autoClearTokens:["balance_compromised"],description:"Top player sitting on bottom player's torso."},back_control:{id:"back_control",name:"Back Control",initiative:"top",topActions:["attack","control"],bottomActions:["defense","sweep"],autoClearTokens:["balance_compromised","inside_position"],description:"Behind the opponent with hooks or body triangle."},turtle:{id:"turtle",name:"Turtle",initiative:"top",topActions:["attack","control"],bottomActions:["defense","sweep"],autoClearTokens:["posture_broken"],description:"Bottom player balled up on hands and knees."},front_headlock:{id:"front_headlock",name:"Front Headlock",initiative:"top",topActions:["attack","control"],bottomActions:["defense","sweep"],autoClearTokens:[],description:"Top player controlling the head from the front."},knee_shield:{id:"knee_shield",name:"Knee Shield Half Guard",initiative:"bottom",topActions:["attack","control"],bottomActions:["attack","defense","sweep","control"],autoClearTokens:[],description:"Half guard variant with knee frame creating distance."}},W=[{id:"takedown",name:"Takedown",category:"attack",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"side_control",userBecomesTop:!0},isSubmission:!1,ibjjfPoints:2},{id:"guard_pull",name:"Guard Pull",category:"attack",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"}],modifier:0,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"closed_guard",userBecomesTop:!1},isSubmission:!1,ibjjfPoints:0},{id:"knee_cut_pass",name:"Knee Cut Pass",category:"attack",availableFrom:[{position:"open_guard",role:"top"},{position:"knee_shield",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"side_control",userBecomesTop:!0},isSubmission:!1,ibjjfPoints:3},{id:"torreando_pass",name:"Toreando Pass",category:"attack",availableFrom:[{position:"open_guard",role:"top"}],modifier:1,risk:"risky",requiredTokens:[],tokenReward:null,transition:{position:"side_control",userBecomesTop:!0},isSubmission:!1,ibjjfPoints:3},{id:"mount_transition",name:"Mount Transition",category:"attack",availableFrom:[{position:"side_control",role:"top"},{position:"half_guard",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"mount",userBecomesTop:!0},isSubmission:!1,ibjjfPoints:4},{id:"back_take",name:"Back Take",category:"attack",availableFrom:[{position:"mount",role:"top"},{position:"turtle",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"back_control",userBecomesTop:!0},isSubmission:!1,ibjjfPoints:4},{id:"americana",name:"Americana",category:"attack",availableFrom:[{position:"side_control",role:"top"},{position:"mount",role:"top"}],modifier:2,risk:"neutral",requiredTokens:["arm_isolated"],tokenReward:null,transition:null,isSubmission:!0,ibjjfPoints:0},{id:"kimura",name:"Kimura",category:"attack",availableFrom:[{position:"side_control",role:"top"},{position:"closed_guard",role:"bottom"},{position:"half_guard",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!0,ibjjfPoints:0},{id:"cross_collar_choke",name:"Cross Collar Choke",category:"attack",availableFrom:[{position:"mount",role:"top"},{position:"closed_guard",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:["posture_broken"],tokenReward:null,transition:null,isSubmission:!0,ibjjfPoints:0},{id:"rear_naked_choke",name:"Rear Naked Choke",category:"attack",availableFrom:[{position:"back_control",role:"top"}],modifier:3,risk:"neutral",requiredTokens:["posture_broken"],tokenReward:null,transition:null,isSubmission:!0,ibjjfPoints:0},{id:"armbar",name:"Armbar",category:"attack",availableFrom:[{position:"mount",role:"top"},{position:"closed_guard",role:"bottom"},{position:"back_control",role:"top"}],modifier:2,risk:"risky",requiredTokens:["arm_isolated"],tokenReward:null,transition:null,isSubmission:!0,ibjjfPoints:0},{id:"triangle",name:"Triangle Choke",category:"attack",availableFrom:[{position:"closed_guard",role:"bottom"},{position:"open_guard",role:"bottom"}],modifier:2,risk:"risky",requiredTokens:["posture_broken"],tokenReward:null,transition:null,isSubmission:!0,ibjjfPoints:0},{id:"guillotine",name:"Guillotine",category:"attack",availableFrom:[{position:"front_headlock",role:"top"},{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"},{position:"closed_guard",role:"bottom"}],modifier:2,risk:"risky",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!0,ibjjfPoints:0},{id:"darce_choke",name:"D'Arce Choke",category:"attack",availableFrom:[{position:"front_headlock",role:"top"},{position:"side_control",role:"top"}],modifier:2,risk:"risky",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!0,ibjjfPoints:0},{id:"ezekiel_choke",name:"Ezekiel Choke",category:"attack",availableFrom:[{position:"mount",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!0,ibjjfPoints:0},{id:"ankle_lock",name:"Ankle Lock",category:"attack",availableFrom:[{position:"open_guard",role:"bottom"},{position:"open_guard",role:"top"}],modifier:1,risk:"risky",requiredTokens:["leg_isolated"],tokenReward:null,transition:null,isSubmission:!0,ibjjfPoints:0},{id:"crossface",name:"Crossface",category:"control",availableFrom:[{position:"side_control",role:"top"},{position:"half_guard",role:"top"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1,ibjjfPoints:0},{id:"chest_pressure",name:"Chest Pressure",category:"control",availableFrom:[{position:"mount",role:"top"},{position:"side_control",role:"top"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1,ibjjfPoints:0},{id:"seatbelt_grip",name:"Seatbelt Grip",category:"control",availableFrom:[{position:"back_control",role:"top"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1,ibjjfPoints:0},{id:"head_control",name:"Head Control",category:"control",availableFrom:[{position:"front_headlock",role:"top"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1,ibjjfPoints:0},{id:"collar_tie",name:"Collar Tie",category:"control",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1,ibjjfPoints:0},{id:"posture_break",name:"Posture Break",category:"control",availableFrom:[{position:"closed_guard",role:"bottom"},{position:"open_guard",role:"bottom"},{position:"closed_guard",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:"posture_broken",transition:null,isSubmission:!1,ibjjfPoints:0},{id:"underhook_control",name:"Underhook",category:"control",availableFrom:[{position:"half_guard",role:"bottom"},{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"},{position:"knee_shield",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:"inside_position",transition:null,isSubmission:!1,ibjjfPoints:0},{id:"wrist_control",name:"Wrist Control",category:"control",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"},{position:"closed_guard",role:"top"},{position:"closed_guard",role:"bottom"},{position:"open_guard",role:"top"},{position:"open_guard",role:"bottom"},{position:"mount",role:"top"},{position:"side_control",role:"top"},{position:"half_guard",role:"top"},{position:"back_control",role:"top"},{position:"knee_shield",role:"bottom"}],modifier:0,risk:"neutral",requiredTokens:[],tokenReward:"arm_isolated",transition:null,isSubmission:!1,ibjjfPoints:0},{id:"leg_lace",name:"Leg Entangle",category:"control",availableFrom:[{position:"open_guard",role:"top"},{position:"open_guard",role:"bottom"},{position:"half_guard",role:"bottom"},{position:"knee_shield",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:"leg_isolated",transition:null,isSubmission:!1,ibjjfPoints:0},{id:"knee_shield_frame",name:"Knee Shield",category:"control",availableFrom:[{position:"knee_shield",role:"bottom"},{position:"half_guard",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1,ibjjfPoints:0},{id:"body_lock",name:"Body Lock",category:"control",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"},{position:"back_control",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:"balance_compromised",transition:null,isSubmission:!1,ibjjfPoints:0},{id:"frame_and_shrimp",name:"Frame & Shrimp",category:"defense",availableFrom:[{position:"side_control",role:"bottom"},{position:"mount",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1,ibjjfPoints:0},{id:"guard_recovery",name:"Guard Recovery",category:"defense",availableFrom:[{position:"side_control",role:"bottom"},{position:"half_guard",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"closed_guard",userBecomesTop:!1},isSubmission:!1,ibjjfPoints:0},{id:"posture_up",name:"Posture Up",category:"defense",availableFrom:[{position:"closed_guard",role:"top"},{position:"open_guard",role:"top"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,tokenRemove:"posture_broken",transition:null,isSubmission:!1,ibjjfPoints:0},{id:"hand_fighting",name:"Hand Fighting",category:"defense",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"},{position:"closed_guard",role:"top"},{position:"closed_guard",role:"bottom"},{position:"open_guard",role:"top"},{position:"open_guard",role:"bottom"},{position:"side_control",role:"bottom"},{position:"mount",role:"bottom"},{position:"back_control",role:"bottom"},{position:"knee_shield",role:"bottom"}],modifier:0,risk:"neutral",requiredTokens:[],tokenReward:null,tokenRemove:"arm_isolated",transition:null,isSubmission:!1,ibjjfPoints:0},{id:"bridge",name:"Bridge",category:"defense",availableFrom:[{position:"mount",role:"bottom"},{position:"side_control",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1,ibjjfPoints:0},{id:"turtle_up",name:"Turtle Up",category:"defense",availableFrom:[{position:"side_control",role:"bottom"},{position:"mount",role:"bottom"},{position:"back_control",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"turtle",userBecomesTop:!1},isSubmission:!1,ibjjfPoints:0},{id:"sprawl",name:"Sprawl",category:"defense",availableFrom:[{position:"standing_neutral",role:"top"},{position:"standing_neutral",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1,ibjjfPoints:0},{id:"shell_guard",name:"Shell Guard",category:"defense",availableFrom:[{position:"mount",role:"bottom"},{position:"back_control",role:"bottom"},{position:"side_control",role:"bottom"},{position:"front_headlock",role:"bottom"},{position:"turtle",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:null,isSubmission:!1,ibjjfPoints:0},{id:"scissor_sweep",name:"Scissor Sweep",category:"sweep",availableFrom:[{position:"closed_guard",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"mount",userBecomesTop:!0},isSubmission:!1,ibjjfPoints:2},{id:"hip_bump_sweep",name:"Hip Bump Sweep",category:"sweep",availableFrom:[{position:"closed_guard",role:"bottom"}],modifier:3,risk:"risky",requiredTokens:[],tokenReward:null,transition:{position:"mount",userBecomesTop:!0},isSubmission:!1,ibjjfPoints:2},{id:"elbow_escape",name:"Elbow Escape",category:"sweep",availableFrom:[{position:"mount",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"half_guard",userBecomesTop:!1},isSubmission:!1,ibjjfPoints:0},{id:"trap_and_roll",name:"Trap & Roll",category:"sweep",availableFrom:[{position:"mount",role:"bottom"}],modifier:3,risk:"neutral",requiredTokens:["arm_isolated"],tokenReward:null,transition:{position:"closed_guard",userBecomesTop:!0},isSubmission:!1,ibjjfPoints:2},{id:"granby_roll",name:"Granby Roll",category:"sweep",availableFrom:[{position:"turtle",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"closed_guard",userBecomesTop:!1},isSubmission:!1,ibjjfPoints:0},{id:"technical_standup",name:"Technical Standup",category:"sweep",availableFrom:[{position:"open_guard",role:"bottom"},{position:"closed_guard",role:"bottom"},{position:"knee_shield",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"standing_neutral",userBecomesTop:!1},isSubmission:!1,ibjjfPoints:0},{id:"back_escape",name:"Back Escape",category:"sweep",availableFrom:[{position:"back_control",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"half_guard",userBecomesTop:!1},isSubmission:!1,ibjjfPoints:0},{id:"old_school_sweep",name:"Old School Sweep",category:"sweep",availableFrom:[{position:"half_guard",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:["inside_position"],tokenReward:null,transition:{position:"side_control",userBecomesTop:!0},isSubmission:!1,ibjjfPoints:2},{id:"sit_out",name:"Sit Out",category:"sweep",availableFrom:[{position:"turtle",role:"bottom"},{position:"front_headlock",role:"bottom"}],modifier:2,risk:"risky",requiredTokens:[],tokenReward:null,transition:{position:"standing_neutral",userBecomesTop:!1},isSubmission:!1,ibjjfPoints:0},{id:"knee_shield_recover",name:"Reguard to Knee Shield",category:"sweep",availableFrom:[{position:"side_control",role:"bottom"},{position:"half_guard",role:"bottom"}],modifier:1,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"knee_shield",userBecomesTop:!1},isSubmission:!1,ibjjfPoints:0},{id:"headlock_escape",name:"Duck Under",category:"sweep",availableFrom:[{position:"front_headlock",role:"bottom"}],modifier:2,risk:"neutral",requiredTokens:[],tokenReward:null,transition:{position:"back_control",userBecomesTop:!0},isSubmission:!1,ibjjfPoints:4}];function T(e,o,r=null){return W.filter(n=>!(!n.availableFrom.some(l=>l.position===e&&l.role===o)||r&&n.category!==r))}function A(e,o){return!e.requiredTokens||e.requiredTokens.length===0?!0:e.requiredTokens.every(r=>o.includes(r))}function $(e,o){const r=w[e];return r?o==="top"?r.topActions:r.bottomActions:[]}function Y(e,o){return U[e]?.[o]??0}const O=2,M=12,B=20,g={MATCH_START:"match_start",TURN_START:"turn_start",ACTION_SELECTION:"action_selection",ACTION_LOCKED:"action_locked",RESOLUTION:"resolution",TURN_END:"turn_end",MATCH_END:"match_end"},h={MINOR:"minor",MAJOR:"major",DOMINANT:"dominant"};function I(){return{phase:g.MATCH_START,turnNumber:0,position:"standing_neutral",playerIsTop:!0,scores:{player:0,ai:0},advantages:{player:0,ai:0},tokens:{player:[],ai:[]},control:{player:0,ai:0},playerCategory:null,playerTechnique:null,aiCategory:null,aiTechnique:null,lastResolution:null,matchWinner:null,matchEndReason:null,aiDifficulty:"medium"}}function j(){return Math.floor(Math.random()*6)+1}function q(e,o,r){const n=e.tokens[o];return n.includes(r)||n.length>=O?!1:(n.push(r),!0)}function C(e,o,r){const n=e.tokens[o],i=n.indexOf(r);return i===-1?!1:(n.splice(i,1),!0)}function G(e,o){const r=w[o];if(!(!r||!r.autoClearTokens))for(const n of r.autoClearTokens)C(e,"player",n),C(e,"ai",n)}function S(e,o,r,n,i,l,t,c=null){const s=t,d=Y(r,i),p=n.modifier,u=l.length,m=c!==null?c:j();return{total:s+d+p+u+m,breakdown:{posControl:s,matchupMod:d,techniqueMod:p,tokenMod:u,die:m}}}function K(e){return e<=1?h.MINOR:e<=3?h.MAJOR:h.DOMINANT}function J(e){return e.ibjjfPoints===2?e.id==="takedown"?"Takedown":"Sweep":e.ibjjfPoints===3?"Guard Pass":e.ibjjfPoints===4?e.transition?.position==="mount"?"Mount":"Back Control":""}function z(e,o=null){const r=S(e.position,e.playerIsTop,e.playerCategory,e.playerTechnique,e.aiCategory,e.tokens.player,e.control.player,o?.playerDie??null),n=S(e.position,!e.playerIsTop,e.aiCategory,e.aiTechnique,e.playerCategory,e.tokens.ai,e.control.ai,o?.aiDie??null),i=Math.abs(r.total-n.total),l=K(i),t={playerScore:r,aiScore:n,margin:i,winner:null,loser:null,tier:l,winnerTechnique:null,loserTechnique:null,pointsAwarded:0,advantagesAwarded:0,tokensGained:[],tokensLost:[],positionChange:null,controlShift:null,submission:!1,narratives:[]};if(i===0)return t.narratives.push("Stalemate! Neither fighter gains an edge."),t;const c=r.total>n.total?"player":"ai",s=c==="player"?"ai":"player";t.winner=c,t.loser=s,t.winnerTechnique=c==="player"?e.playerTechnique:e.aiTechnique,t.loserTechnique=c==="player"?e.aiTechnique:e.playerTechnique;const d=t.winnerTechnique;if(d.isSubmission&&l===h.DOMINANT)return t.submission=!0,t.narratives.push(`${d.name} locked in! Submission!`),t;if((c==="player"?e.playerCategory:e.aiCategory)==="control"&&(e.control[s]>0?(e.control[s]-=1,t.controlShift={lost:s},t.narratives.push(`${s==="player"?"You lose":"Opponent loses"} a control point!`)):e.control[c]<2&&(e.control[c]+=1,t.controlShift={gained:c},t.narratives.push(`${c==="player"?"You gain":"Opponent gains"} a control point!`))),(l===h.MAJOR||l===h.DOMINANT)&&(d.tokenReward&&q(e,c,d.tokenReward)&&(t.tokensGained.push({who:c,token:d.tokenReward}),t.narratives.push(`${c==="player"?"You gain":"Opponent gains"} ${b[d.tokenReward].name}!`)),l===h.DOMINANT&&!d.tokenReward)){const u=["posture_broken","inside_position","arm_isolated","balance_compromised","leg_isolated"],m=e.tokens[c],f=u.filter(k=>!m.includes(k));if(f.length>0&&m.length<O){const k=f[Math.floor(Math.random()*f.length)];q(e,c,k),t.tokensGained.push({who:c,token:k}),t.narratives.push(`${c==="player"?"You gain":"Opponent gains"} ${b[k].name}!`)}}if(d.tokenRemove&&l!==h.MINOR&&C(e,s,d.tokenRemove)&&(t.tokensLost.push({who:s,token:d.tokenRemove}),t.narratives.push(`${s==="player"?"You lose":"Opponent loses"} ${b[d.tokenRemove].name}!`)),l===h.DOMINANT&&e.tokens[s].length>0){const u=e.tokens[s][0];C(e,s,u),t.tokensLost.push({who:s,token:u}),t.narratives.push(`${s==="player"?"You lose":"Opponent loses"} ${b[u].name}!`)}if(d.transition){const u=d.transition,m=e.position,f=w[u.position];if(t.positionChange={from:m,to:u.position},c==="player"?e.playerIsTop=u.userBecomesTop:e.playerIsTop=!u.userBecomesTop,e.position=u.position,G(e,u.position),t.narratives.push(`Transition to ${f.name}!`),d.ibjjfPoints>0)if(l===h.MAJOR||l===h.DOMINANT){t.pointsAwarded=d.ibjjfPoints,e.scores[c]+=t.pointsAwarded;const k=J(d);t.narratives.push(`${c==="player"?"You score":"Opponent scores"} ${t.pointsAwarded} points! (${k})`)}else t.advantagesAwarded=1,e.advantages[c]+=1,t.narratives.push(`Close exchange! ${c==="player"?"You earn":"Opponent earns"} an advantage.`)}else l===h.MAJOR||l===h.DOMINANT?(t.advantagesAwarded=1,e.advantages[c]+=1,d.isSubmission?t.narratives.push(`Close submission attempt! ${c==="player"?"You earn":"Opponent earns"} an advantage.`):t.narratives.push(`Dominant control! ${c==="player"?"You earn":"Opponent earns"} an advantage.`)):t.narratives.push("A tense exchange ‚Äî neither fighter gains much ground.");return t}function V(e){e.phase=g.TURN_START,e.turnNumber=1,e.position="standing_neutral",e.playerIsTop=Math.random()>.5,e.scores={player:0,ai:0},e.advantages={player:0,ai:0},e.tokens={player:[],ai:[]},e.control={player:0,ai:0},e.matchWinner=null,e.matchEndReason=null,e.lastResolution=null}function Q(e){e.phase=g.ACTION_SELECTION,e.playerCategory=null,e.playerTechnique=null,e.aiCategory=null,e.aiTechnique=null}function X(e,o,r,n,i){e.playerCategory=o,e.playerTechnique=r,e.aiCategory=n,e.aiTechnique=i,e.phase=g.ACTION_LOCKED}function Z(e,o=null){e.phase=g.RESOLUTION;const r=z(e,o);return e.lastResolution=r,r.submission?(e.matchWinner=r.winner,e.matchEndReason=`Submission by ${r.winnerTechnique.name}!`,e.phase=g.MATCH_END,r):e.scores.player>=M?(e.matchWinner="player",e.matchEndReason="Points victory!",e.phase=g.MATCH_END,r):e.scores.ai>=M?(e.matchWinner="ai",e.matchEndReason="Points victory!",e.phase=g.MATCH_END,r):e.turnNumber>=B?(e.scores.player>e.scores.ai?(e.matchWinner="player",e.matchEndReason="Points victory! (Time expired)"):e.scores.ai>e.scores.player?(e.matchWinner="ai",e.matchEndReason="Points victory! (Time expired)"):e.advantages.player>e.advantages.ai?(e.matchWinner="player",e.matchEndReason="Wins by advantages! (Points tied)"):e.advantages.ai>e.advantages.player?(e.matchWinner="ai",e.matchEndReason="Wins by advantages! (Points tied)"):(e.matchWinner=Math.random()>.5?"player":"ai",e.matchEndReason="Referee's decision! (All tied)"),e.phase=g.MATCH_END,r):(e.phase=g.TURN_END,r)}function ee(e){e.turnNumber++,e.phase=g.TURN_START}function oe(e){const o=S(e.position,e.playerIsTop,e.playerCategory,e.playerTechnique,e.aiCategory,e.tokens.player,e.control.player,0),r=S(e.position,!e.playerIsTop,e.aiCategory,e.aiTechnique,e.playerCategory,e.tokens.ai,e.control.ai,0),n=o.total-r.total;return{playerBase:o,aiBase:r,advantage:n}}function _(e){return w[e.position].initiative==="neutral",e.playerIsTop?"top":"bottom"}function te(e){return $(e.position,_(e))}function ne(e,o){return T(e.position,_(e),o)}function ie(e,o){return A(o,e.tokens.player)}const P={easy:{optimalWeight:.4},medium:{optimalWeight:.65},hard:{optimalWeight:.85}};function re(e,o,r,n,i,l,t,c){let s=0;return s+=n.modifier*2,n.isSubmission&&(s+=3,A(n,i)&&(s+=4)),n.transition&&(n.ibjjfPoints>0&&(s+=n.ibjjfPoints*1.5),!n.transition.userBecomesTop&&o==="bottom"&&(s+=c*2)),n.tokenReward&&i.length<2&&(s+=2,s+=1),n.tokenRemove&&l.length>0&&(s+=2),n.risk==="risky"&&(s-=1),r==="control"&&(c>0?s+=c*2:t<2&&(s+=2)),r==="defense"&&c>=2&&(s+=2),r==="sweep"&&c>0&&(s+=c),Math.max(s,0)}function se(e){const o=P[e.aiDifficulty]||P.medium,r=e.playerIsTop?"bottom":"top",n=$(e.position,r);if(n.length===0)throw new Error(`AI has no available categories at position ${e.position} as ${r}`);const i=[];for(const d of n){const p=T(e.position,r,d);for(const u of p){if(!A(u,e.tokens.ai))continue;const f=re(e.position,r,d,u,e.tokens.ai,e.tokens.player,e.control.ai,e.control.player);i.push({category:d,technique:u,score:f})}}if(i.length===0)for(const d of n){const p=T(e.position,r,d);for(const u of p)i.push({category:d,technique:u,score:1})}if(i.length===0)throw new Error("AI has no available techniques");i.sort((d,p)=>p.score-d.score);const l=i[0].score,t=i.filter(d=>d.score>=l-1),c=i.filter(d=>d.score<l-1);let s;return Math.random()<o.optimalWeight&&t.length>0?s=t[Math.floor(Math.random()*t.length)]:c.length>0?s=c[Math.floor(Math.random()*c.length)]:s=t[Math.floor(Math.random()*t.length)],{category:s.category,technique:s.technique}}const a=e=>document.getElementById(e),E={standing_neutral:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.6"><circle cx="65" cy="35" r="12" stroke="#f85149" stroke-width="2.5" fill="none"/>
      <line x1="65" y1="47" x2="65" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="65" y1="65" x2="45" y2="85" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="65" y1="65" x2="85" y2="85" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="65" y1="100" x2="50" y2="140" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="65" y1="100" x2="80" y2="140" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
      <g opacity="0.6"><circle cx="115" cy="35" r="12" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="115" y1="47" x2="115" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="115" y1="65" x2="95" y2="85" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="115" y1="65" x2="135" y2="85" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="115" y1="100" x2="100" y2="140" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="115" y1="100" x2="130" y2="140" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,closed_guard:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><line x1="40" y1="120" x2="140" y2="120" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <circle cx="140" cy="120" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="80" y1="120" x2="75" y2="90" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="120" x2="95" y2="90" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="50" y1="120" x2="35" y2="145" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="60" y1="120" x2="50" y2="150" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="85" cy="70" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="85" y1="81" x2="85" y2="115" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="85" y1="90" x2="65" y2="105" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="85" y1="90" x2="105" y2="105" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="85" y1="115" x2="70" y2="140" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="85" y1="115" x2="100" y2="140" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,open_guard:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><line x1="50" y1="125" x2="140" y2="125" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <circle cx="140" cy="125" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="80" y1="125" x2="70" y2="95" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="125" x2="90" y2="95" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="55" y1="125" x2="50" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="60" y1="125" x2="65" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="80" cy="62" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="80" y1="73" x2="80" y2="108" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="80" y1="85" x2="60" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="85" x2="100" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="108" x2="65" y2="135" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="108" x2="95" y2="135" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,half_guard:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><line x1="45" y1="125" x2="135" y2="125" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <circle cx="135" cy="125" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="85" y1="125" x2="80" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="95" y1="125" x2="90" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="55" y1="125" x2="55" y2="145" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="65" y1="125" x2="75" y2="140" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="80" cy="75" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="80" y1="86" x2="85" y2="118" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="80" y1="95" x2="60" y2="110" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="95" x2="100" y2="110" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="85" y1="118" x2="70" y2="145" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="85" y1="118" x2="100" y2="145" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,side_control:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><line x1="35" y1="125" x2="140" y2="125" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <circle cx="140" cy="125" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="90" y1="125" x2="95" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="110" y1="125" x2="108" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="45" y1="125" x2="30" y2="150" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="55" y1="125" x2="45" y2="155" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><line x1="70" y1="95" x2="115" y2="80" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <circle cx="65" cy="90" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="85" y1="90" x2="100" y2="115" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="85" x2="120" y2="108" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="115" y1="80" x2="140" y2="65" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="115" y1="80" x2="145" y2="82" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,mount:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><line x1="35" y1="130" x2="145" y2="130" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <circle cx="145" cy="130" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="90" y1="130" x2="85" y2="105" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="110" y1="130" x2="115" y2="105" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="45" y1="130" x2="30" y2="155" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="55" y1="130" x2="50" y2="158" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="90" cy="60" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="90" y1="71" x2="90" y2="110" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="90" y1="85" x2="65" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="85" x2="115" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="110" x2="70" y2="135" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="110" x2="110" y2="135" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,back_control:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><circle cx="90" cy="80" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="90" y1="91" x2="90" y2="125" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="105" x2="70" y2="115" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="105" x2="110" y2="115" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="125" x2="75" y2="150" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="125" x2="105" y2="150" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="90" cy="55" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="90" y1="66" x2="90" y2="100" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="90" y1="78" x2="68" y2="95" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="78" x2="112" y2="95" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="100" x2="72" y2="128" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="100" x2="108" y2="128" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,turtle:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><circle cx="130" cy="115" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="120" y1="115" x2="70" y2="110" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="112" x2="95" y2="140" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="111" x2="75" y2="140" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="105" y1="112" x2="115" y2="138" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="75" y1="111" x2="60" y2="138" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="90" cy="72" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="90" y1="83" x2="90" y2="108" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="90" y1="92" x2="65" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="92" x2="115" y2="100" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="108" x2="75" y2="135" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="90" y1="108" x2="105" y2="135" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,front_headlock:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><circle cx="100" cy="95" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="100" y1="106" x2="95" y2="130" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="112" x2="80" y2="125" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="112" x2="120" y2="120" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="95" y1="130" x2="80" y2="155" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="95" y1="130" x2="110" y2="155" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="80" cy="55" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="80" y1="66" x2="80" y2="100" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="80" y1="78" x2="60" y2="90" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="78" x2="100" y2="88" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="100" x2="65" y2="130" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="100" x2="95" y2="130" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`,knee_shield:`
    <svg viewBox="0 0 180 180" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5"><line x1="45" y1="125" x2="140" y2="125" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <circle cx="140" cy="125" r="11" stroke="#58a6ff" stroke-width="2.5" fill="none"/>
      <line x1="90" y1="125" x2="80" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="100" y1="125" x2="90" y2="100" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="55" y1="125" x2="55" y2="95" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="65" y1="125" x2="85" y2="105" stroke="#58a6ff" stroke-width="2.5" stroke-linecap="round"/></g>
      <g><circle cx="80" cy="68" r="11" stroke="#f85149" stroke-width="2.5" fill="rgba(248,81,73,0.12)"/>
      <line x1="80" y1="79" x2="82" y2="112" stroke="#f85149" stroke-width="3" stroke-linecap="round"/>
      <line x1="80" y1="90" x2="60" y2="105" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="80" y1="90" x2="100" y2="105" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="82" y1="112" x2="67" y2="140" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/>
      <line x1="82" y1="112" x2="97" y2="140" stroke="#f85149" stroke-width="2.5" stroke-linecap="round"/></g>
    </svg>`},ae={takedown:"ü§º",guard_pull:"‚¨áÔ∏è",knee_cut_pass:"ü¶µ",torreando_pass:"üí®",mount_transition:"‚¨ÜÔ∏è",back_take:"üîÑ",americana:"üí™",kimura:"üîí",cross_collar_choke:"‚úã",rear_naked_choke:"üêç",armbar:"üí™",triangle:"üî∫",guillotine:"‚ö°",darce_choke:"üåÄ",ezekiel_choke:"‚úä",ankle_lock:"ü¶∂",crossface:"ü§ö",chest_pressure:"‚¨áÔ∏è",seatbelt_grip:"üîó",head_control:"‚úã",collar_tie:"ü§ù",posture_break:"‚¨áÔ∏è",underhook_control:"üî≤",wrist_control:"‚úä",leg_lace:"ü¶µ",knee_shield_frame:"üõ°Ô∏è",body_lock:"üîí",frame_and_shrimp:"ü¶ê",guard_recovery:"üîÑ",posture_up:"‚¨ÜÔ∏è",hand_fighting:"‚úã",bridge:"üåâ",turtle_up:"üê¢",sprawl:"üèãÔ∏è",shell_guard:"üõ°Ô∏è",scissor_sweep:"‚úÇÔ∏è",hip_bump_sweep:"üí•",elbow_escape:"üîì",trap_and_roll:"üé≤",granby_roll:"üåÄ",technical_standup:"üßç",back_escape:"üèÉ",old_school_sweep:"üîÑ",sit_out:"‚Ü©Ô∏è",knee_shield_recover:"üõ°Ô∏è",headlock_escape:"‚Ü™Ô∏è"};function le(e){const o=[];if(e.isSubmission&&o.push("Submission attempt"),e.ibjjfPoints>0&&o.push(`${e.ibjjfPoints}pts`),e.transition){const r=w[e.transition.position];o.push(`‚Üí ${r?.name||e.transition.position}`)}return e.tokenReward&&o.push(`Earns: ${b[e.tokenReward].name}`),e.tokenRemove&&o.push(`Removes opp: ${b[e.tokenRemove].name}`),e.risk==="risky"&&o.push("Risky"),o.length===0&&o.push("Maintain position"),o.join(" ¬∑ ")}function R(e){document.querySelectorAll(".screen").forEach(o=>{o.classList.remove("active")}),a(e).classList.add("active")}function ce(e){const o=w[e.position],r=_(e);a("score-player").textContent=e.scores.player,a("score-ai").textContent=e.scores.ai,a("adv-player").textContent=e.advantages.player,a("adv-ai").textContent=e.advantages.ai,a("turn-number").textContent=`${e.turnNumber}/${B}`,a("ai-difficulty-label").textContent=e.aiDifficulty.charAt(0).toUpperCase()+e.aiDifficulty.slice(1),a("position-name").textContent=o.name;const n=a("initiative-badge");o.initiative==="neutral"?(n.className="initiative-badge neutral",a("initiative-text").textContent="Neutral"):(n.className="initiative-badge "+(r==="top"?"top":"bottom"),a("initiative-text").textContent=r==="top"?"You: Top Position":"You: Bottom Position"),a("silhouette-container").innerHTML=E[e.position]||E.standing_neutral;const i=a("control-pips");i.innerHTML="";const l=e.control.ai,t=e.control.player;for(let d=0;d<5;d++){const p=document.createElement("div");if(d<2){const u=2-d;p.className="pip"+(t>=u?" filled-player":"")}else if(d===2)p.className="pip";else{const u=d-2;p.className="pip"+(l>=u?" filled-ai":"")}i.appendChild(p)}t>0?(a("control-value").textContent=`+${t}`,a("control-value").style.color=""):l>0?(a("control-value").textContent=`-${l}`,a("control-value").style.color="var(--red)"):(a("control-value").textContent="+0",a("control-value").style.color=""),L("player-tokens",e.tokens.player),L("ai-tokens",e.tokens.ai);const c=a("turn-text"),s=a("pulse-dot");c.textContent="Select Your Action",c.className="turn-text selecting",s.className="pulse-dot"}function L(e,o){const r=a(e);r.innerHTML="";for(let n=0;n<2;n++){const i=document.createElement("div");if(o[n]){const l=b[o[n]];i.className="token-badge-compact active",i.innerHTML=`<span class="token-icon">${l.icon}</span>`,i.title=l.name}else i.className="token-badge-compact empty",i.innerHTML='<span class="token-icon">‚óã</span>',i.title="Empty";r.appendChild(i)}}function de(e,o){const r=a("action-grid");r.innerHTML="";const n=_(e),i=te(e),l=["control","attack","defense","sweep"],c=w[e.position].initiative==="neutral"?["attack"]:n==="top"?["attack"]:["sweep"];for(const s of l){const d=v[s],p=i.includes(s),u=document.createElement("div"),m=p?T(e.position,n,s):[],f=m.length>0&&m.every(H=>H.risk==="risky");let k;p?c.includes(s)?k="optimal":f?k="risky":k="neutral":k="disabled",u.className=`action-btn ${k}`,u.innerHTML=`
      <span class="act-icon">${d.icon}</span>
      <span class="act-name">${d.name}</span>
      <span class="act-hint">${d.hint}</span>
    `,p&&u.addEventListener("click",()=>o(s)),r.appendChild(u)}}function ue(e,o,r){const n=v[o];_(e);const i=ne(e,o);a("drawer-title").textContent=`${n.name} Techniques`,a("drawer-title").style.color=o==="attack"?"var(--red)":o==="control"?"var(--accent)":o==="defense"?"var(--green)":"var(--purple)";const l=a("technique-list");l.innerHTML="";for(const t of i){const c=ie(e,t),s=document.createElement("div");s.className="technique-item"+(c?"":" locked");const d=t.requiredTokens.length>0?t.requiredTokens.map(f=>b[f].name).join(", "):"No requirement",p=t.requiredTokens.length>0?c?"":" locked-req":" none",u=ae[t.id]||"‚ö°",m=le(t);s.innerHTML=`
      <span class="tech-icon">${u}</span>
      <div class="tech-info">
        <div class="tech-name">${t.name}</div>
        <div class="tech-desc">${m}</div>
      </div>
      <div class="tech-meta">
        <span class="tech-mod">+${t.modifier}</span>
        <span class="tech-req${p}">${c?"":"üîí "}${d}</span>
      </div>
    `,c&&s.addEventListener("click",()=>{N(),r(t)}),l.appendChild(s)}a("technique-drawer").classList.add("open"),a("overlay-backdrop").classList.add("visible")}function N(){a("technique-drawer").classList.remove("open"),a("overlay-backdrop").classList.remove("visible")}function pe(e,o,r){const n=a("resolution-overlay"),i=a("res-header");i.textContent="SHOWDOWN",i.className="res-header major";const l=v[e.playerCategory];a("res-player-category").textContent=l.icon+" "+l.name,a("res-player-technique").textContent=e.playerTechnique.name,a("res-player-score").textContent=o.playerBase.total;const t=o.playerBase.breakdown;a("res-player-breakdown").innerHTML=`Ctrl: ${t.posControl} ¬∑ Match: ${t.matchupMod>0?"+":""}${t.matchupMod}<br>Tech: +${t.techniqueMod} ¬∑ Tok: +${t.tokenMod} ¬∑ Die: üé≤`;const c=v[e.aiCategory];a("res-ai-category").textContent=c.icon+" "+c.name,a("res-ai-technique").textContent=e.aiTechnique.name,a("res-ai-score").textContent=o.aiBase.total;const s=o.aiBase.breakdown;a("res-ai-breakdown").innerHTML=`Ctrl: ${s.posControl} ¬∑ Match: ${s.matchupMod>0?"+":""}${s.matchupMod}<br>Tech: +${s.techniqueMod} ¬∑ Tok: +${s.tokenMod} ¬∑ Die: üé≤`;const d=a("res-advantage"),p=o.advantage;p>0?(d.textContent=`+${p} Advantage`,d.className="res-advantage adv-positive"):p<0?(d.textContent=`‚àí${Math.abs(p)} Disadvantage`,d.className="res-advantage adv-negative"):(d.textContent="Even Matchup",d.className="res-advantage adv-even");const u=a("res-die-player"),m=a("res-die-ai");u.textContent="?",u.className="res-die",m.textContent="?",m.className="res-die",a("res-outcome").classList.add("pre-roll-hidden"),a("res-narratives").classList.add("pre-roll-hidden"),n.classList.add("visible");const f=a("res-continue"),k=f.cloneNode(!0);f.parentNode.replaceChild(k,f),k.id="res-continue",k.textContent="Roll Dice üé≤",k.addEventListener("click",()=>{k.disabled=!0,k.style.opacity="0.5",r()})}function ke(e,o,r){const n=a("res-die-player"),i=a("res-die-ai");n.className="res-die rolling",i.className="res-die rolling";const l=Date.now(),t=3e3,c=2500;let s=80,d=null;function p(){const u=Date.now()-l;if(u>=t){clearTimeout(d),n.textContent=e,i.textContent=o,n.classList.remove("rolling"),i.classList.remove("rolling"),setTimeout(()=>r(),400);return}n.textContent=Math.floor(Math.random()*6)+1,i.textContent=Math.floor(Math.random()*6)+1,u>=c&&(s=200),d=setTimeout(p,s)}p()}function fe(e,o,r){const n=a("res-header");o.submission?(n.textContent="SUBMISSION!",n.className="res-header submission"):o.pointsAwarded>0?(n.textContent=`${o.pointsAwarded} POINTS!`,n.className="res-header dominant"):o.advantagesAwarded>0?(n.textContent="ADVANTAGE",n.className="res-header major"):o.winner?(n.textContent="NO SCORE",n.className="res-header minor"):(n.textContent="STALEMATE",n.className="res-header minor"),a("res-player-score").textContent=o.playerScore.total;const i=o.playerScore.breakdown;a("res-player-breakdown").innerHTML=`Ctrl: ${i.posControl} ¬∑ Match: ${i.matchupMod>0?"+":""}${i.matchupMod}<br>Tech: +${i.techniqueMod} ¬∑ Tok: +${i.tokenMod} ¬∑ Die: ${i.die}`,a("res-ai-score").textContent=o.aiScore.total;const l=o.aiScore.breakdown;a("res-ai-breakdown").innerHTML=`Ctrl: ${l.posControl} ¬∑ Match: ${l.matchupMod>0?"+":""}${l.matchupMod}<br>Tech: +${l.techniqueMod} ¬∑ Tok: +${l.tokenMod} ¬∑ Die: ${l.die}`;const t=a("res-die-player"),c=a("res-die-ai");o.winner?o.winner==="player"?(t.classList.add("result-win"),c.classList.add("result-lose")):(t.classList.add("result-lose"),c.classList.add("result-win")):(t.classList.add("result-draw"),c.classList.add("result-draw")),a("res-advantage").textContent="";const s=a("res-outcome");s.classList.remove("pre-roll-hidden"),o.winner?o.winner==="player"?(o.submission?s.textContent=`You win by ${o.winnerTechnique.name}!`:o.pointsAwarded>0?s.textContent=`You score ${o.pointsAwarded} points!`:o.advantagesAwarded>0?s.textContent="You earn an advantage!":s.textContent="You win the exchange!",s.className="res-outcome win"):(o.submission?s.textContent=`Opponent wins by ${o.winnerTechnique.name}!`:o.pointsAwarded>0?s.textContent=`Opponent scores ${o.pointsAwarded} points!`:o.advantagesAwarded>0?s.textContent="Opponent earns an advantage!":s.textContent="Opponent wins the exchange!",s.className="res-outcome lose"):(s.textContent="Even exchange ‚Äî stalemate!",s.className="res-outcome draw");const d=a("res-narratives");d.classList.remove("pre-roll-hidden"),d.innerHTML="";for(const m of o.narratives){const f=document.createElement("div");f.className="res-narrative-item",f.textContent=m,d.appendChild(f)}const p=a("res-continue"),u=p.cloneNode(!0);p.parentNode.replaceChild(u,p),u.id="res-continue",u.textContent="Continue",u.disabled=!1,u.style.opacity="",u.addEventListener("click",()=>{a("resolution-overlay").classList.remove("visible"),r()})}function me(e,o,r){const n=e.matchWinner==="player";a("end-icon").textContent=n?"üèÜ":"üòî",a("end-title").textContent=n?"Victory!":"Defeat",a("end-title").className="end-title "+(n?"win":"lose"),a("end-reason").textContent=e.matchEndReason||"",a("end-score").innerHTML=`<span style="color:var(--accent)">${e.scores.player}</span> <span style="color:var(--text-dim)">‚Äì</span> <span style="color:var(--red)">${e.scores.ai}</span><div style="font-size:14px;color:var(--text-dim);margin-top:4px">Advantages: ${e.advantages.player} ‚Äì ${e.advantages.ai}</div>`;const i=a("btn-rematch"),l=a("btn-menu"),t=i.cloneNode(!0),c=l.cloneNode(!0);i.parentNode.replaceChild(t,i),l.parentNode.replaceChild(c,l),t.id="btn-rematch",c.id="btn-menu",t.addEventListener("click",o),c.addEventListener("click",r),R("screen-end")}function ye(){const e=a("turn-text");e.textContent="Resolving...",e.className="turn-text resolving",a("pulse-dot").className="pulse-dot resolving",document.querySelectorAll(".action-btn").forEach(o=>{o.classList.add("disabled"),o.style.pointerEvents="none"})}let y=I();function he(){document.querySelectorAll(".diff-btn").forEach(e=>{e.addEventListener("click",()=>{document.querySelectorAll(".diff-btn").forEach(o=>o.classList.remove("active")),e.classList.add("active"),y.aiDifficulty=e.dataset.diff})}),document.getElementById("btn-start").addEventListener("click",()=>{F()})}function F(){y=I();const e=document.querySelector(".diff-btn.active");e&&(y.aiDifficulty=e.dataset.diff),V(y),R("screen-match"),D()}function D(){Q(y),ce(y),de(y,ge)}function ge(e){ue(y,e,be)}function be(e){const o=se(y);X(y,e.category,e,o.category,o.technique),ye(),setTimeout(()=>{const r=oe(y);pe(y,r,()=>{const n=j(),i=j();ke(n,i,()=>{const l=Z(y,{playerDie:n,aiDie:i});fe(y,l,()=>{y.phase===g.MATCH_END?me(y,()=>F(),()=>{R("screen-start")}):(ee(y),D())})})})},600)}document.getElementById("overlay-backdrop").addEventListener("click",N);document.getElementById("drawer-close").addEventListener("click",N);const x=document.getElementById("how-to-play-overlay");document.getElementById("btn-how-to-play").addEventListener("click",()=>{x.classList.add("visible")});document.getElementById("htp-close").addEventListener("click",()=>{x.classList.remove("visible")});x.addEventListener("click",e=>{e.target===x&&x.classList.remove("visible")});he();R("screen-start");
